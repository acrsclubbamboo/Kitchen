<!DOCTYPE html>
<html>
  <head>
    <!-- Other head tags here -->
    <script>
      setInterval(function() {
        console.log('Fetching data...');
        fetch('https://script.google.com/macros/s/AKfycbw6HdkhKYFk-CX7wzGC3CAz4aHJo2ZNDzxYQbY_4VwF2TlybKp8ecZ2eQEzQ4UYeW_7/exec')
        .then(response => response.json())
        .then(data => {
          var outputDiv = document.getElementById('output');

          // Clear previous data
          outputDiv.innerHTML = '';

          // Create a table
          var table = document.createElement('table');
          outputDiv.appendChild(table);

          // Loop over each row in the data
          data.forEach((row, index) => {
            // Skip rows that don't have the necessary columns
            if (row.length < 7) {
              return;
            }

            // Create a new row in the table
            var tableRow = document.createElement('tr');
            table.appendChild(tableRow);

            console.log(row[4]);

            // Check the validity of the time value before creating a Date object and calling substring
            var timeString = '';
            if (row[4]) {
              var dateObject = new Date(row[4]);
              if (dateObject instanceof Date && !isNaN(dateObject)) {
                var dateString = dateObject.toUTCString();
                var dateParts = dateString.split(' ');
                if (dateParts.length > 4) {
                  timeString = dateParts[4].substring(0, 5);
                }
              }
            }
            var columns = [row[2], timeString, row[5], row[6]];
            
            for (var i = 0; i < columns.length; i++) {
              var tableCell = document.createElement(index === 0 ? 'th' : 'td');
              tableCell.textContent = columns[i];
              tableRow.appendChild(tableCell);
            }
          });
        })
        .catch(error => console.error('Error:', error));
      }, 5000); // Reduced to 5 seconds for testing
    </script>
  </head>
  <body>
    <!-- Your webpage content here -->
    <div id="output"></div>
  </body>
</html>

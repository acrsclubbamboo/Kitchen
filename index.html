<!DOCTYPE html>
<html>
  <head>
    <!-- Other head tags here -->
    <style>
      body {
        padding: 0;  /* No padding on the sides */
        margin: 0;  /* No margin */
      }

      #output {
      }
      
      table {
        font-size: 24px; /* Increase font size */
        margin: 0 auto;
      }

      th {
        font-size: 30px; /* Increase font size for headers */
        font-weight: bold; /* Make headers bold */
        text-align: center; /* Center headers */
        background-color: white;
      }

      td {
        font-weight: bold; /* Make cell text bold */
        text-align: center; /* Center cell text */
        padding-right: 5px; /* Reduce gap after each column */
        max-width: 500px; /* Add a max-width */
        word-wrap: break-word; /* Add word wrap */
      }

      td:nth-child(2), th:nth-child(2) {
        text-align: center; /* Center Time column */
      }

      /* Style for the total meals and veggie count */
      .totals {
        font-weight: bold;
        font-style: italic;
        padding-right: 30px; /* Add more space to the right */
        font-size: 32px; /* Bigger size for the totals row */
        background-color: white;
      }

      /* Style for the green veggie meals count */
      .veggie {
        color: green;
      }

      /* Alternate row colors */
      tr:nth-child(odd) {
        background-color: #b3d9ff; /* light blue */
      }

      tr:nth-child(even) {
        background-color: white;
      }

    </style>
    <script>
      setInterval(function() {
        console.log('Fetching data...');
        fetch('https://script.google.com/macros/s/AKfycbw6HdkhKYFk-CX7wzGC3CAz4aHJo2ZNDzxYQbY_4VwF2TlybKp8ecZ2eQEzQ4UYeW_7/exec')
        .then(response => response.json())
        .then(data => {
          var outputDiv = document.getElementById('output');

          // Clear previous data
          outputDiv.innerHTML = '';

          // Create a table
          var table = document.createElement('table');
          outputDiv.appendChild(table);

          // Add totals row
          var totalsRow = document.createElement('tr');
          var totalCell = document.createElement('td');
          totalCell.textContent = data[0][4]; // E1 cell content
          totalCell.classList.add('totals'); // Add class for styling
          totalCell.colSpan = 2; // span it across 2 columns
          totalsRow.appendChild(totalCell);

          var veggieCell = document.createElement('td');
          veggieCell.textContent = data[0][6]; // G1 cell content
          veggieCell.classList.add('totals', 'veggie'); // Add classes for styling
          veggieCell.colSpan = 2; // span it across 2 columns
          totalsRow.appendChild(veggieCell);

          table.appendChild(totalsRow);

          // Add header row
          var headerRow = document.createElement('tr');
          var headers = ["Name", "Time", "# of Meals", "Comments"];
          headers.forEach(header => {
            var th = document.createElement('th');
            th.textContent = header;
            headerRow.appendChild(th);
          });
          table.appendChild(headerRow);

          // Loop over each row in the data
          data.forEach((row, index) => {
            // Skip the first 2 rows and rows that don't have the necessary columns
            if (index < 2 || row.length < 7) {
              return;
            }

            // Create a new row in the table
            var tableRow = document.createElement('tr');
            table.appendChild(tableRow);

            // Check the validity of the time value before creating a Date object and calling substring
            var timeString = '';
            if (row[4]) {
              if(typeof row[4] == 'string' && row[4].includes('T')) {
                var dateObject = new Date(row[4]);
                if (dateObject instanceof Date && !isNaN(dateObject)) {
                  var dateString = dateObject.toUTCString();
                  var dateParts = dateString.split(' ');
                  if (dateParts.length > 4) {
                    timeString = dateObject.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'America/Los_Angeles' });
                  }
                }
              } else {
                timeString = row[4]; // If not a Date, use the original value
              }
            } else {
              // Default value if Time is empty
              timeString = "12:00";
            }

            var columns = [row[2], timeString, row[5], row[6]];
            
            for (var i = 0; i < columns.length; i++) {
              var tableCell = document.createElement('td');
              tableCell.textContent = columns[i];
              tableRow.appendChild(tableCell);
            }
          });
        })
        .catch(error => console.error('Error:', error));
      }, 5000); // Reduced to 5 seconds for testing
    </script>
  </head>
  <body>
    <!-- Your webpage content here -->
    <div id="output"></div>
  </body>
</html>
